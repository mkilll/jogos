<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Jogo de Tiro 2D</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body { margin:0; background:#232b38;}
    canvas { display:block; margin:0 auto; background:#1a2230; }
    #hud {
      position:absolute; left:10px;top:10px; color:#fff; font-family:sans-serif; font-size:18px; z-index:10;
      background:rgba(0,0,0,0.4); padding:10px; border-radius:7px; user-select:none;
    }
    #hud button { margin-left:8px; font-size:16px;}
  </style>
</head>
<body>
  <div id="hud">
    <span id="ammo"></span> |
    <span id="score"></span>
    <button onclick="reloadWeapon()">Recarregar [R]</button>
    <span id="msg"></span>
  </div>
  <canvas id="game" width="900" height="520"></canvas>
  <script>
    // VARIÁVEIS
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    let width = canvas.width, height = canvas.height;

    // Jogador
    let player = { x:width/2, y:height-60, w:36, h:36, color:"#7ef" };
    let aim = { x:width/2, y:height/2 };

    // Estado da arma
    let maxAmmo = 8;
    let ammo = maxAmmo;
    let reserveAmmo = 24;
    let score = 0;
    let msg = "";

    // Inimigos
    let enemies = [];
    function spawnEnemy() {
      let e = {
        x: Math.random()*(width-60)+30,
        y: Math.random()*220+40,
        r: 22,
        color: "#f44",
        alive: true,
        vx: (Math.random()-0.5)*2.1,
        vy: (Math.random()-0.5)*1.3
      };
      enemies.push(e);
    }
    for(let i=0;i<7;i++) spawnEnemy();

    // HUD
    function updateHud() {
      document.getElementById('ammo').textContent = `Munição: ${ammo} / ${reserveAmmo}`;
      document.getElementById('score').textContent = `Pontos: ${score}`;
      document.getElementById('msg').textContent = msg;
    }
    updateHud();

    // TIRO
    function shoot(x,y) {
      if (ammo <= 0) {
        msg = "Sem munição! Recarregue.";
        updateHud();
        return;
      }
      ammo--;
      msg = "";
      updateHud();
      // Raycast simples: linha do player até o mouse
      for (let e of enemies) {
        if (!e.alive) continue;
        let dx = x-e.x, dy = y-e.y;
        if (Math.sqrt(dx*dx+dy*dy) < e.r+12) {
          e.alive = false;
          score += 100;
          msg = "Inimigo abatido!";
          updateHud();
          break;
        }
      }
    }

    // RECARREGAR
    function reloadWeapon() {
      if (ammo === maxAmmo || reserveAmmo === 0) {
        msg = "Não há necessidade ou munição!";
        updateHud();
        return;
      }
      let needed = maxAmmo - ammo;
      let take = Math.min(needed, reserveAmmo);
      ammo += take;
      reserveAmmo -= take;
      msg = "Recarregado!";
      updateHud();
    }
    window.reloadWeapon = reloadWeapon;

    // INPUT
    canvas.addEventListener('mousemove', e => {
      aim.x = e.offsetX;
      aim.y = e.offsetY;
    });
    canvas.addEventListener('mousedown', e => {
      shoot(e.offsetX, e.offsetY);
    });
    window.addEventListener('keydown', e => {
      if(e.code === 'KeyR') reloadWeapon();
    });

    // LOOP PRINCIPAL
    function drawPlayer() {
      ctx.save();
      ctx.translate(player.x, player.y);
      // Corpo
      ctx.beginPath();
      ctx.arc(0,0,player.w/2,0,2*Math.PI);
      ctx.fillStyle=player.color; ctx.fill();
      // Arma
      let ang = Math.atan2(aim.y-player.y, aim.x-player.x);
      ctx.rotate(ang);
      ctx.fillStyle="#333";
      ctx.fillRect(10,-6,26,12);
      ctx.restore();
      // Mira
      ctx.beginPath();
      ctx.arc(aim.x, aim.y, 11, 0, 2*Math.PI);
      ctx.strokeStyle="#fff"; ctx.lineWidth=2; ctx.stroke();
      ctx.beginPath();
      ctx.arc(aim.x, aim.y, 3, 0, 2*Math.PI);
      ctx.fillStyle="#7ef"; ctx.fill();
    }

    function drawEnemy(e) {
      ctx.save();
      ctx.translate(e.x, e.y);
      ctx.beginPath();
      ctx.arc(0,0,e.r,0,2*Math.PI);
      ctx.fillStyle=e.alive?e.color:"#333"; ctx.fill();
      if(e.alive){
        ctx.beginPath();
        ctx.arc(-6,-6,4.5,0,2*Math.PI); ctx.fillStyle="#fff"; ctx.fill();
        ctx.beginPath();
        ctx.arc(8,-7,4.5,0,2*Math.PI); ctx.fillStyle="#fff"; ctx.fill();
        ctx.beginPath();
        ctx.arc(-6,-6,1.8,0,2*Math.PI); ctx.fillStyle="#222"; ctx.fill();
        ctx.beginPath();
        ctx.arc(8,-7,1.8,0,2*Math.PI); ctx.fillStyle="#222"; ctx.fill();
      }
      ctx.restore();
    }

    function gameLoop() {
      ctx.clearRect(0,0,width,height);
      // Fundo
      ctx.fillStyle="#1a2230";
      ctx.fillRect(0,0,width,height);

      // Player
      drawPlayer();

      // Inimigos
      for(let e of enemies){
        if(e.alive){
          e.x += e.vx;
          e.y += e.vy;
          if(e.x<e.r||e.x>width-e.r) e.vx*=-1;
          if(e.y<e.r||e.y>height/2) e.vy*=-1;
        }
        drawEnemy(e);
      }

      // Respawn
      if(enemies.every(e=>!e.alive)){
        for(let i=0;i<7;i++) spawnEnemy();
      }

      updateHud();
      requestAnimationFrame(gameLoop);
    }
    gameLoop();
  </script>
</body>
</html>
